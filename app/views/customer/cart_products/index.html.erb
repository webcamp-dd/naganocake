<h1>ショッピングカート</h1>

<%= link_to "カートを空にする", customer_cart_products_all_destroy_path, method: :delete, data: {confirm: "本当に削除してもよろしいですか？"}, class: "btn-right btn-sm btn-danger" %>

<table class="table table-inverse">
	<thead>
		<tr>
			<th>商品名</th>
			<th>単価(税込)</th>
			<th>数量</th>
			<th>小計</th>
			<th></th>
		</tr>
    </thead>
    <% sum = 0 %>
    <% @cart_products.each do |cart_product| %>
        <tbody>
            <tr>
                <td><%= cart_product.product.name %></td>
                <td><%= cart_product.product.unit_price %></td>
                <td>
                    <%= form_with model: cart_product, url: customer_cart_product_path(cart_product), method: :patch do |f| %>
                        <%= f.number_field :quantity, selected: cart_product.quantity.to_i %>
                        <%= f.submit "変更" %>
                    <% end %>
                </td>
                <td>
                <% cart_product.product.unit_price %>
                <% sumone = cart_product.quantity.to_i * cart_product.product.unit_price.to_i %>
                <%= sumone.to_s(:delimited) %></td>
                <td>
                    <%= link_to "削除する", customer_cart_product_path(cart_product), method: :delete, data: {confirm: "本当に削除してもよろしいですか？"}, class: "btn-sm btn-danger" %>
                </td>
            </tr>
        </tbody>
        <% sum += sumone %>
    <% end %>
</table>

<%= link_to "買い物を続ける", customer_products_index_path, class: "btn-sm btn-primary" %>

<table class="table table-inverse">
        <tr>
            <th>合計金額</th>
        </tr>
        <tr>
        <td><%= sum.to_s(:delimited) %></td>
    </tr>
</table>

<%= link_to "情報入力に進む", new_customer_order_path, class: "btn-sm btn-success" %>
